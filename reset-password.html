<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Reset Password ‚Äì Dollar App</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
    body {
        margin:0;
        font-family:'Inter', sans-serif;
        background:#f1f5f9;
        min-height:100vh;
        display:flex;
        justify-content:center;
        align-items:center;
        padding:20px;
        box-sizing:border-box;
    }

    .wrapper {
        width:100%;
        display:flex;
        flex-direction:column;
        align-items:center;
    }

    .card {
        width:100%;
        max-width:420px;
        background:white;
        padding:28px;
        border-radius:22px;
        box-shadow:0 4px 15px rgba(0,0,0,0.12);
        box-sizing:border-box;
    }

    h2 {
        text-align:center;
        font-weight:600;
        margin-bottom:16px;
        font-size:22px;
    }

    p {
        text-align:center;
        font-size:15px;
        color:#555;
        margin-bottom:20px;
    }

    /* ===== INPUT WRAPPER ===== */
    .input-wrap {
        position:relative;
        margin-bottom:15px;
    }

    input {
        width:100%;
        padding:15px 45px 15px 15px;
        border-radius:14px;
        border:1px solid #d1d5db;
        outline:none;
        font-size:17px;
        text-align:center;
        box-sizing:border-box;
    }

    input::placeholder {
        text-align:center;
        color:#9ca3af;
    }

    /* ===== ICON EYE ===== */
    .eye {
        position:absolute;
        right:14px;
        top:50%;
        transform:translateY(-50%);
        cursor:pointer;
        font-size:18px;
        color:#000;
        opacity:0.7;
        user-select:none;
    }

    button {
        width:100%;
        padding:14px;
        border-radius:12px;
        border:none;
        background:#3b82f6;
        color:white;
        font-weight:600;
        font-size:17px;
        cursor:pointer;
    }

    button:disabled {
        background:#94a3b8;
        cursor:not-allowed;
    }

    .watermark {
        margin-top:14px;
        text-align:center;
        font-size:12px;
        color:#9ca3af;
        line-height:1.4;
    }

    .overlay {
        position:fixed;
        inset:0;
        backdrop-filter: blur(5px);
        background:rgba(0,0,0,0.2);
        display:none;
        justify-content:center;
        align-items:center;
        z-index:999;
    }

    .modal {
        background:white;
        padding:25px;
        border-radius:18px;
        max-width:300px;
        text-align:center;
    }

    .toast {
        position:fixed;
        top:20px;
        left:50%;
        transform:translateX(-50%);
        background:#111827;
        color:white;
        padding:12px 18px;
        border-radius:12px;
        font-size:14px;
        opacity:0;
        transition:0.3s;
        z-index:1000;
    }

    .toast.show {
        opacity:1;
        top:30px;
    }
</style>
</head>

<body>

<div class="wrapper">

<div class="card">
<h2>Reset Password</h2>
<p>Silakan masukkan password baru untuk akun kamu.</p>

<div class="input-wrap">
    <input id="newPass" type="password" placeholder="Password baru...">
    <span class="eye" onclick="togglePass('newPass', this)">üëÅ</span>
</div>

<div class="input-wrap">
    <input id="confirmPass" type="password" placeholder="Konfirmasi password...">
    <span class="eye" onclick="togglePass('confirmPass', this)">üëÅ</span>
</div>

<button id="btnReset" onclick="resetNow()">Update Password</button>
</div>

<div class="watermark">
¬© Powered by <b>PP Daruttauhid Al Alawi</b>
<div class="version">Version 5.11</div>
</div>

</div>

<div id="overlay" class="overlay">
<div class="modal">
<div id="msg"></div>
<button onclick="closeModal()">Oke</button>
</div>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { auth, verifyPasswordResetCode, confirmPasswordReset } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { app } from "./firebase.js";

const params = new URLSearchParams(location.search);
const oobCode = params.get("oobCode");
const usedKey = "reset_used_" + oobCode;

if (!oobCode || localStorage.getItem(usedKey)) {
    show("Link reset password sudah digunakan atau tidak valid.");
    btnReset.disabled = true;
}

window.resetNow = async () => {
    const p1 = newPass.value.trim();
    const p2 = confirmPass.value.trim();

    if (!p1 || !p2) return toast("Isi semua kolom");
    if (p1 !== p2) return toast("Password tidak sama");
    if (p1.length < 6) return toast("Minimal 6 karakter");

    try {
        await confirmPasswordReset(auth, oobCode, p1);
        localStorage.setItem(usedKey, "true");

        newPass.value = "";
        confirmPass.value = "";
        btnReset.disabled = true;

        toast("Password berhasil diperbarui");
        show("Password berhasil diperbarui");

        setTimeout(()=>location.href="login.html",2500);
    } catch {
        toast("Gagal memperbarui password");
    }
};

window.togglePass = (id, el) => {
    const input = document.getElementById(id);
    if (input.type === "password") {
        input.type = "text";
        el.textContent = "üôà";
    } else {
        input.type = "password";
        el.textContent = "üëÅ";
    }
};

function show(t){ msg.innerText=t; overlay.style.display="flex"; }
function closeModal(){ overlay.style.display="none"; }
function toast(t){
    toastEl.innerText=t;
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"),2000);
}
const toastEl=document.getElementById("toast");
</script>

</body>
</html>
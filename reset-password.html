<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Reset Password – Dollar App</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
    body {
        margin:0;
        font-family:'Inter', sans-serif;
        background:#f1f5f9;
        height:100vh;
        display:flex;
        justify-content:center;
        align-items:center;
        padding:20px;
    }

    .card {
        width:100%;
        max-width:420px;
        background:white;
        padding:28px;
        border-radius:22px;
        box-shadow:0 4px 15px rgba(0,0,0,0.12);
    }

    h2 {
        text-align:center;
        font-weight:600;
        margin-bottom:16px;
        font-size:22px;
    }

    p {
        text-align:center;
        font-size:15px;
        color:#555;
        margin-bottom:20px;
    }

    input {
        width:100%;
        padding:15px;
        border-radius:14px;
        border:1px solid #d1d5db;
        outline:none;
        font-size:17px; /* ≥16px supaya HP tidak zoom */
        margin-bottom:15px;
        text-align:center; /* <=== rata tengah */
        box-sizing:border-box;
    }

    input::placeholder {
        text-align:center;
        color:#9ca3af;
    }

    button {
        width:100%;
        padding:14px;
        border-radius:12px;
        border:none;
        background:#3b82f6;
        color:white;
        font-weight:600;
        font-size:17px; /* ≥16px */
        cursor:pointer;
    }

    button:active {
        background:#2563eb;
    }

    /* Modal overlay */
    .overlay {
        position:fixed;
        top:0; left:0;
        width:100%; height:100%;
        backdrop-filter: blur(5px);
        background:rgba(0,0,0,0.2);
        display:none;
        justify-content:center;
        align-items:center;
        padding:20px;
    }

    .modal {
        background:white;
        padding:25px;
        border-radius:18px;
        width:100%;
        max-width:300px;
        text-align:center;
        box-shadow:0 4px 15px rgba(0,0,0,0.2);
    }

    .modal button {
        margin-top:15px;
        background:#10b981;
        font-size:16px;
    }
</style>

</head>

<body>

<div class="card">
    <h2>Reset Password</h2>
    <p>Silakan masukkan password baru untuk akun kamu.</p>

    <input id="newPass" type="password" placeholder="Password baru..." />
    <input id="confirmPass" type="password" placeholder="Konfirmasi password..." />
    <button onclick="resetNow()">Update Password</button>
</div>

<!-- Modal Notifikasi -->
<div id="overlay" class="overlay">
    <div class="modal">
        <div id="msg">Berhasil!</div>
        <button onclick="closeModal()">Oke</button>
    </div>
</div>

<script type="module">
import {
    auth,
    verifyPasswordResetCode,
    confirmPasswordReset
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { app } from "./firebase.js";

// =============================
// Ambil action code (oobCode)
// =============================
const params = new URLSearchParams(window.location.search);
const oobCode = params.get("oobCode");

// =============================
// Validasi Link Reset Password
// =============================
let userEmail = "";

if (!oobCode) {
    show("Link reset password tidak valid.");
} else {
    verifyPasswordResetCode(auth, oobCode)
        .then(email => {
            userEmail = email;
        })
        .catch(() => {
            show("Link sudah kadaluarsa atau tidak valid.");
        });
}

// =============================
// Fungsi Reset Password
// =============================
window.resetNow = async () => {
    const pass1 = document.getElementById("newPass").value.trim();
    const pass2 = document.getElementById("confirmPass").value.trim();

    if (!pass1 || !pass2) {
        show("Isi semua kolom password!");
        return;
    }

    if (pass1 !== pass2) {
        show("Password tidak sama.");
        return;
    }

    if (pass1.length < 6) {
        show("Password minimal 6 karakter.");
        return;
    }

    try {
        await confirmPasswordReset(auth, oobCode, pass1);
        show("Password berhasil diperbarui.");
    }
    catch (err) {
        show("Gagal: " + err.message);
    }
};

// =============================
// Modal Handler
// =============================
function show(text) {
    document.getElementById("msg").innerText = text;
    document.getElementById("overlay").style.display = "flex";
}

window.closeModal = () => {
    document.getElementById("overlay").style.display = "none";
};
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Reset Password – Dollar App</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
    body {
        margin:0;
        font-family:'Inter', sans-serif;
        background:#f1f5f9;
        min-height:100vh;
        display:flex;
        justify-content:center;
        align-items:center;
        padding:20px;
        box-sizing:border-box;
    }

    .wrapper {
        width:100%;
        display:flex;
        flex-direction:column;
        align-items:center;
    }

    .card {
        width:100%;
        max-width:420px;
        background:white;
        padding:28px;
        border-radius:22px;
        box-shadow:0 4px 15px rgba(0,0,0,0.12);
        box-sizing:border-box;
    }

    h2 {
        text-align:center;
        font-weight:600;
        margin-bottom:16px;
        font-size:22px;
    }

    p {
        text-align:center;
        font-size:15px;
        color:#555;
        margin-bottom:20px;
    }

    input {
        width:100%;
        padding:15px;
        border-radius:14px;
        border:1px solid #d1d5db;
        outline:none;
        font-size:17px;
        margin-bottom:15px;
        text-align:center;
        box-sizing:border-box;
    }

    input::placeholder {
        text-align:center;
        color:#9ca3af;
    }

    button {
        width:100%;
        padding:14px;
        border-radius:12px;
        border:none;
        background:#3b82f6;
        color:white;
        font-weight:600;
        font-size:17px;
        cursor:pointer;
    }

    button:active {
        background:#2563eb;
    }

    .watermark {
        margin-top:14px;
        text-align:center;
        font-size:12px;
        color:#9ca3af;
        line-height:1.4;
    }

    .watermark span {
        font-weight:600;
        color:#64748b;
    }

    .watermark .version {
        font-size:11px;
        opacity:0.8;
    }

    /* ================= MODAL ================= */
    .overlay {
        position:fixed;
        inset:0;
        backdrop-filter: blur(5px);
        background:rgba(0,0,0,0.2);
        display:none;
        justify-content:center;
        align-items:center;
        padding:20px;
        z-index:999;
    }

    .modal {
        background:white;
        padding:25px;
        border-radius:18px;
        width:100%;
        max-width:300px;
        text-align:center;
        box-shadow:0 4px 15px rgba(0,0,0,0.2);
    }

    .modal button {
        margin-top:15px;
        background:#10b981;
        font-size:16px;
    }

    /* ================= TOAST (TAMBAHAN) ================= */
    .toast {
        position:fixed;
        top:20px;
        left:50%;
        transform:translateX(-50%);
        background:#111827;
        color:white;
        padding:12px 18px;
        border-radius:12px;
        font-size:14px;
        opacity:0;
        pointer-events:none;
        transition:0.3s ease;
        z-index:1000;
    }

    .toast.show {
        opacity:1;
        top:30px;
    }
</style>
</head>

<body>

<div class="wrapper">

    <div class="card">
        <h2>Reset Password</h2>
        <p>Silakan masukkan password baru untuk akun kamu.</p>

        <input id="newPass" type="password" placeholder="Password baru..." />
        <input id="confirmPass" type="password" placeholder="Konfirmasi password..." />
        <button onclick="resetNow()">Update Password</button>
    </div>

    <div class="watermark">
        © Powered by <span>PP Daruttauhid Al Alawi</span>
        <div class="version">Version 5.11</div>
    </div>

</div>

<!-- MODAL -->
<div id="overlay" class="overlay">
    <div class="modal">
        <div id="msg">Berhasil!</div>
        <button onclick="closeModal()">Oke</button>
    </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast"></div>

<script type="module">
import {
    auth,
    verifyPasswordResetCode,
    confirmPasswordReset
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { app } from "./firebase.js";

const params = new URLSearchParams(window.location.search);
const oobCode = params.get("oobCode");

if (!oobCode) {
    show("Link reset password tidak valid.");
} else {
    verifyPasswordResetCode(auth, oobCode)
        .catch(() => {
            show("Link reset sudah kadaluarsa atau tidak valid.");
        });
}

window.resetNow = async () => {
    const pass1 = newPass.value.trim();
    const pass2 = confirmPass.value.trim();

    if (!pass1 || !pass2)
        return toast("Isi semua kolom password!");

    if (pass1 !== pass2)
        return toast("Password tidak sama.");

    if (pass1.length < 6)
        return toast("Password minimal 6 karakter.");

    try {
        await confirmPasswordReset(auth, oobCode, pass1);

        toast("Password berhasil diperbarui");
        show("Password berhasil diperbarui");

        /* ===== AUTO REDIRECT KE LOGIN ===== */
        setTimeout(() => {
            window.location.href = "login.html";
        }, 2500);

    } catch (err) {
        toast("Gagal memperbarui password");
        show("Gagal memperbarui password.");
    }
};

/* ===== MODAL ===== */
function show(text) {
    msg.innerText = text;
    overlay.style.display = "flex";
}

window.closeModal = () => {
    overlay.style.display = "none";
};

/* ===== TOAST ===== */
function toast(text) {
    const t = document.getElementById("toast");
    t.innerText = text;
    t.classList.add("show");

    setTimeout(() => {
        t.classList.remove("show");
    }, 2000);
}
</script>

</body>
</html>